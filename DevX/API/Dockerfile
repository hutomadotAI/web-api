FROM tomcat:7-jre8
MAINTAINER  Pedro Teixeira pedrotei@hutoma.com

RUN rm -rf /usr/local/tomcat/webapps/ROOT
COPY ./target/HutomaAPI.war /usr/local/tomcat/webapps/ROOT.war


# Expose the following environment variables
ENV API_ENCODING_KEY encodingKey
ENV API_MAX_UPLOAD_SIZE 65536
ENV API_MAX_CLUSTER_LINES 10000
ENV API_CONNECTION_STRING jdbc:mysql://server:3306/hutoma?user=user&password=password&zeroDateTimeBehavior=convertToNull
ENV API_DBCONNECTIONPOOL_MIN_SIZE 8
ENV API_DBCONNECTIONPOOL_MAX_SIZE 64
ENV API_CLUSTER_MIN_PROBABILITY 0.7
ENV API_RATELIMIT_CHAT_BURST 3.0
ENV API_RATELIMIT_CHAT_FREQUENCY 2.0
ENV API_RATELIMIT_QUICKREAD_BURST 5.0
ENV API_RATELIMIT_QUICKREAD_FREQUENCY 0.5
ENV API_RATELIMIT_LOADTEST_BURST 32768.0
ENV API_RATELIMIT_LOADTEST_FREQUENCY 8192.5
ENV API_AI_WNET_ENDPOINT http://ai-wnet:9090/ai
ENV API_AI_RNN_ENDPOINT http://ai-rnn:10356/ai
ENV API_AI_AIML_ENDPOINT http://ai-aiml:8080/ai
ENV API_LOGGING_URL http://log-svc:8080/log
ENV API_LOGGING_CADENCY 5000

EXPOSE 8080

CMD ["catalina.sh", "run"]


EXPOSE 80